{% extends "nav.html" %}
{% load static %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Startup Simulation</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0b0d1a;
  --glass:rgba(255,255,255,.08);
  --border:rgba(255,255,255,.14);
  --customer:#22d3ee;
  --ceo:#a855f7;
  --marketing:#4ade80;
  --finance:#fb7185;
  --tech:#60a5fa;
}

*{box-sizing:border-box;font-family:Inter,system-ui}

body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(1200px 600px at 10% 10%,#1a1140,transparent),
             radial-gradient(1200px 600px at 90% 90%,#2b0f2b,transparent),
             var(--bg);
  color:#e5e7eb;
  display:flex;
  flex-direction:column;
}

header{
  padding:20px;
  text-align:center;
  font-size:20px;
  letter-spacing:.5px;
}

#chat{
  flex:1;
  padding:20px;
  max-width:900px;
  margin:auto;
  display:flex;
  flex-direction:column;
}

.message {
  display: flex;
  align-items: flex-end;
  gap: 12px;
  margin-bottom: 18px;
  opacity: 0;
  transform: translateY(12px);
  transition: .5s ease;
}

.message.show {
  opacity: 1;
  transform: none;
}

.message.right {
  flex-direction: row-reverse;
}

.avatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,.25);
  object-fit: cover;
  background: #111;
  transition: box-shadow 0.4s ease, transform 0.4s ease;
}
.message.show .avatar {
  box-shadow:
    0 0 12px rgba(168,85,247,0.6),
    0 0 24px rgba(168,85,247,0.45),
    0 0 48px rgba(168,85,247,0.25);
  transform: scale(1.05);
}

/* ---------- Agent-specific glow colors ---------- */
.customer .avatar {
  box-shadow:
    0 0 10px rgba(34,211,238,.6),
    0 0 30px rgba(34,211,238,.4);
}

.ceo .avatar {
  box-shadow:
    0 0 12px rgba(168,85,247,.7),
    0 0 36px rgba(168,85,247,.45);
}

.marketing .avatar {
  box-shadow:
    0 0 12px rgba(74,222,128,.6),
    0 0 32px rgba(74,222,128,.4);
}

.finance .avatar {
  box-shadow:
    0 0 12px rgba(251,113,133,.6),
    0 0 32px rgba(251,113,133,.4);
}

.tech .avatar {
  box-shadow:
    0 0 12px rgba(96,165,250,.6),
    0 0 32px rgba(96,165,250,.4);
}

/* ---------- Optional pulse animation ---------- */
@keyframes glowPulse {
  0% { box-shadow: 0 0 10px rgba(168,85,247,.4); }
  50% { box-shadow: 0 0 28px rgba(168,85,247,.8); }
  100% { box-shadow: 0 0 10px rgba(168,85,247,.4); }
}

.message.show .avatar {
  animation: glowPulse 2s infinite ease-in-out;
}
.bubble {
  max-width: 65%;
  padding: 14px 18px;
  border-radius: 18px;
  border: 1px solid var(--border);
  background: var(--glass);
  backdrop-filter: blur(14px);
  line-height: 1.5;
  animation: pop .3s ease;
}
@keyframes pop {
  from { transform: scale(.95); }
  to { transform: scale(1); }
}

.customer .bubble { border-left: 4px solid var(--customer); }
.ceo .bubble { border-right: 4px solid var(--ceo); }
.marketing .bubble { border-left: 4px solid var(--marketing); }
.finance .bubble { border-right: 4px solid var(--finance); }
.tech .bubble { border-left: 4px solid var(--tech); }

footer{
  padding:20px;
  display:flex;
  justify-content:center;
  gap:20px;
}

button{
  padding:14px 24px;
  border:none;
  border-radius:12px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(135deg,#a855f7,#7c3aed);
  color:white;
  box-shadow:0 12px 30px rgba(168,85,247,.4);
}

button:disabled{
  opacity:.6;
  cursor:not-allowed;
}

#score{
  text-align:center;
  margin-top:10px;
  font-size:18px;
}
</style>
</head>

<body>

<header>ü§ñ AI Startup Agent Simulation</header>

<div id="chat"></div>

<footer>
  <button id="startBtn">Start Simulation</button>
</footer>



<script>
const chat = document.getElementById("chat");
const startBtn = document.getElementById("startBtn");
const scoreBox = document.getElementById("score");
const AVATARS = {
  customer: "/static/core/images/lucid-origin_Futuristic_AI_customer_agent_avatar_humanoid_android_with_human-like_warmth_soft-0.jpg",
  ceo: "/static/core/images/lucid-origin_Futuristic_AI_CEO_avatar_humanoid_android_leader_wearing_a_sleek_black_tech_suit-0.jpg",
  marketing: "/static/core/images/lucid-origin_Futuristic_AI_marketing_agent_avatar_energetic_humanoid_robot_stylish_futuristic-0.jpg",
  finance: "/static/core/images/lucid-origin_Futuristic_AI_finance_agent_avatar_calm_and_analytical_humanoid_android_minimali-0.jpg",
  tech:"/static/core/images/tech.png"
};

// CSRF (Django-safe)
function getCSRF(){
  return document.cookie.split("; ")
    .find(r=>r.startsWith("csrftoken="))
    ?.split("=")[1];
}

// Add chat bubble
function addBubble(agent, text) {
  if (!agent || !text) return;

  const role = agent.toLowerCase();
  const isRight = role === "ceo" || role === "finance";

  const wrapper = document.createElement("div");
  wrapper.className = `message ${role} ${isRight ? "right" : ""}`;

  const avatar = document.createElement("img");
  avatar.className = "avatar";
  avatar.src = AVATARS[role] || "/static/avatars/default.png";
  avatar.alt = agent;

  const bubble = document.createElement("div");
  bubble.className = "bubble";
  bubble.innerHTML = `<strong>${agent}</strong><br>${text}`;

  wrapper.appendChild(avatar);
  wrapper.appendChild(bubble);

  chat.appendChild(wrapper);

  requestAnimationFrame(() => {
    wrapper.classList.add("show");
  });

  chat.scrollTop = chat.scrollHeight;
}

// Run one agent step
async function runStep(){
  const res = await fetch("/run-simulation/",{
    method:"POST",
    headers:{
      "X-CSRFToken":getCSRF()
    }
  });

  const data = await res.json();

  addBubble(data.agent, data.output);

  if(!data.done){
    setTimeout(runStep, 1600); // dramatic pause üòå
  }else{
    finalize();
  }
}

// Final score
async function finalize(){
  const res = await fetch("/canvas/");
  const data = await res.json();

  scoreBox.innerHTML = `
    ‚úÖ Success: <strong>${data.success}%</strong>
    &nbsp;&nbsp;‚ùå Risk: <strong>${data.failure}%</strong>
  `;
}

startBtn.onclick = ()=>{
  startBtn.disabled = true;
  startBtn.innerText = "Simulation Running...";
  runStep();
};
</script>
{% endblock content %}
</body>
</html>
